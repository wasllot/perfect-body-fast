(()=>{"use strict";var t="#appointmentsTable";function e(t){$.ajax({type:"POST",url:route("razorpay.failed"),data:{data:t},success:function(t){t.success&&displaySuccessMessage(t.message)},error:function(){}})}$(document).ready((function(){var e=moment().startOf("week"),a=moment().endOf("week"),n=$("#patientAppointmentDate");function o(t,e){n.html(t.format("YYYY-MM-DD")+" - "+e.format("YYYY-MM-DD"))}n.daterangepicker({startDate:e,endDate:a,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"This Week":[moment().startOf("week"),moment().endOf("week")],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},o),o(e,a);var i=isEmpty(userRole)?route("appointments.index"):route("patients.appointments.index"),s=$(t).DataTable({deferRender:!0,processing:!0,serverSide:!0,searchDelay:500,language:{lengthMenu:"Show _MENU_"},order:[[1,"desc"]],ajax:{url:i,data:function(t){t.status=$("#patientAppointmentStatus").find("option:selected").val(),t.payment_type=$("#patientPaymentStatus").find("option:selected").val(),t.filter_date=n.val()}},columnDefs:[{targets:[0],width:"25%"},{targets:[1],width:"20%"},{targets:[2],width:"20%"},{targets:[3],searchable:!1},{targets:[4],orderable:!1,searchable:!1},{targets:[5],className:"text-center",orderable:!1}],columns:[{data:function(t){var e=calculateAvgRating(t.doctor.reviews);return'<div class="symbol symbol-circle symbol-50px overflow-hidden me-3">\n                        <div class="symbol-label">\n                            <img src="'.concat(t.doctor.user.profile_image,'" alt=""\n                                 class="w-100 object-cover">\n                        </div>\n                    </div>\n                    <div class="d-inline-block align-top">\n                        <div class="d-inline-block align-self-center d-flex">\n                            <a class="text-primary-800 mb-1 d-inline-block align-self-center">').concat(t.doctor.user.full_name,'</a>\n                            <div class="star-ratings d-inline-block align-self-center ms-2">\n                                 <div class="fill-ratings" style="width: ').concat(e,'%;">\n                                     <span>★★★★★</span>\n                                 </div>\n                            </div>\n                        </div>\n                        <span class="d-block text-muted fw-bold">').concat(t.doctor.user.email,"</span>\n                    </div>")},name:"doctor.user.full_name"},{data:function(t){return'<div class="badge badge-light-info">\n                                <div class="mb-2">'.concat(t.from_time," ").concat(t.from_time_type," - ").concat(t.to_time," ").concat(t.to_time_type,'</div>\n                                <div class="">').concat(moment(t.date).format("Do MMM, Y "),"</div>\n                            </div>")},name:"date"},{data:function(t){return currencyIcon+" "+addCommas(t.payable_amount)},name:"payable_amount"},{data:function(t){return 2===t.payment_type?'<span class="badge badge-light-success">'.concat(paid,"</span>"):'<span class="badge badge-light-danger">'.concat(pending,'</span>\n                        <a href="javascript:void(0)" data-id="').concat(t.id,'" class="btn btn-icon btn-bg-light text-hover-primary btn-sm me-1 payment-btn" data-bs-custom-class="tooltip-dark" data-bs-placement="bottom" title="Appointment Payment">\n                            <i class="far fa-credit-card fs-4"></i>\n                        </a>')},name:"payment_type"},{data:function(t){var e=t.status;return'<div class="w-120px d-flex align-items-center">\n                                <span class="bg-'.concat(["danger","primary","success","warning","danger"][e],' rounded-circle h-10px w-10px me-2"></span>\n                                <span class="">').concat({1:"Booked",2:"Check In",3:"Check Out",4:"Cancelled"}[e],"</span>\n                            </div>")},name:"status"},{data:function(t){var e=[{id:t.id,role:userRole,canceled:t.status,showUrl:route("patients.appointment.detail",t.id)}];return prepareTemplateRender("#appointmentsTemplate",e)},name:"id"}],fnInitComplete:function(){$("#patientAppointmentStatus").change((function(){$("#filter").removeClass("show"),$("#filterBtn").removeClass("show"),$("#appointmentsTable").DataTable().ajax.reload(null,!0)})),$("#patientPaymentStatus").change((function(){$("#filter").removeClass("show"),$("#filterBtn").removeClass("show"),$("#appointmentsTable").DataTable().ajax.reload(null,!0)})),$("#patientAppointmentDate").change((function(){$("#appointmentsTable").DataTable().ajax.reload(null,!0)}))}});handleSearchDatatable(s),$(document).on("click","#resetFilter",(function(){$("#patientPaymentStatus").val(allPaymentCount).trigger("change"),$("#patientAppointmentStatus").val(book).trigger("change"),n.data("daterangepicker").setStartDate(moment().startOf("week").format("MM/DD/YYYY")),n.data("daterangepicker").setEndDate(moment().endOf("week").format("MM/DD/YYYY"))}))})),$(document).on("click",".delete-btn",(function(e){var a=$(e.currentTarget).data("id"),n=isEmpty(userRole)?route("appointments.destroy",a):route("patients.appointments.destroy",a);deleteItem(n,t,"Appointment")})),$(document).on("click",".cancel-appointment",(function(e){var a=$(e.currentTarget).data("id");cancelAppointment(route("patients.cancel-status"),t,"Appointment",a)})),window.cancelAppointment=function(t,e,a,n){Swal.fire({title:"Cancelled Appointment !",text:"Are you sure want to cancel this "+a+" ?",type:"warning",icon:"warning",showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#266CB0",showLoaderOnConfirm:!0,cancelButtonText:"No",confirmButtonText:"Yes"}).then((function(t){t.isConfirmed&&function(t,e,a,n){$.ajax({url:route("patients.cancel-status"),type:"POST",data:{appointmentId:n},success:function(t){t.success&&(1==$(e).DataTable().data().count()?$(e).DataTable().page("previous").draw("page"):$(e).DataTable().ajax.reload(null,!1)),Swal.fire({title:"Cancelled Appointment!",text:a+" has been Cancelled.",icon:"success",confirmButtonColor:"#266CB0",timer:2e3})},error:function(t){Swal.fire({title:"Error",icon:"error",text:t.responseJSON.message,type:"error",confirmButtonColor:"#266CB0",timer:5e3})}})}(0,e,a,n)}))},$(document).on("submit","#patientPaymentForm",(function(t){var a=$("#paymentGatewayType").val(),n=$("#patientAppointmentId").val(),o=$(this).find("#submitBtn");return setAdminBtnLoader(o),a==stripeMethod&&$.ajax({url:route("patients.appointment-payment"),type:"POST",data:{appointmentId:n},success:function(t){var e=t.data.sessionId;stripe.redirectToCheckout({sessionId:e}).then((function(t){manageAjaxErrors(t)}))}}),a==paytmMethod&&window.location.replace(route("paytm.init",{appointmentId:n})),a==paystackMethod&&window.location.replace(route("paystack.init",{appointmentData:n})),a==authorizeMethod&&window.location.replace(route("authorize.init",{appointmentId:n})),a==paypalMethod&&$.ajax({type:"GET",url:route("paypal.init"),data:{appointmentId:n},success:function(t){if(201==t.statusCode){var e="";$.each(t.result.links,(function(t,a){"approve"==a.rel&&(e=a.href)})),location.href=e}},error:function(t){},complete:function(){}}),a==razorpayMethod&&$.ajax({type:"POST",url:route("razorpay.init"),data:{appointmentId:n},success:function(t){if(t.success){var a=t.data,o=a.id,i=a.amount,s=a.name,r=a.email,c=a.contact;options.amount=i,options.order_id=o,options.prefill.name=s,options.prefill.email=r,options.prefill.contact=c,options.prefill.appointmentID=n;var l=new Razorpay(options);l.open(),l.on("payment.failed",e)}},error:function(t){},complete:function(){}}),!1})),$(document).on("click",".payment-btn",(function(t){var e=$(this).data("id");$("#paymentGatewayModal").modal("show").appendTo("body"),$("#patientAppointmentId").val(e)})),$("#paymentGatewayModal").on("hidden.bs.modal",(function(t){$("#patientPaymentForm")[0].reset(),$("#paymentGatewayType").val(null).trigger("change")}))})();