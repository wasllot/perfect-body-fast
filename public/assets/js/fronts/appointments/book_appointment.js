(()=>{"use strict";var e="#templateAppointmentDate";function t(e){$.ajax({type:"POST",url:route("razorpay.failed"),data:{data:e},success:function(e){e.success&&displaySuccessMessage(e.message)},error:function(){}})}$(document).ready((function(){$("#templateAppointmentDate").datepicker({format:"yyyy-mm-dd",startDate:new Date,todayHighlight:!0});var a,o=(new Date).getTimezoneOffset();o=0===o?0:-o,$("#isPatientAccount").on("change",(function(){this.checked?($(".name-details").addClass("d-none"),$(".registered-patient").removeClass("d-none"),$("#template-medical-email").keyup((function(){$("#patientName").val("");var e=$("#template-medical-email").val();$.ajax({url:route("get-patient-name"),type:"GET",data:{email:e},success:function(e){e.data&&$("#patientName").val(e.data)}})}))):($(".name-details").removeClass("d-none"),$(".registered-patient").addClass("d-none"))})),$(".no-time-slot").removeClass("d-none"),$(document).on("change",e,(function(){a=$(this).val(),$("#slotData").html(""),$.ajax({url:route("doctor-session-time"),type:"GET",data:{doctorId:$("#doctorId").val(),date:a,timezone_offset_minutes:o},success:function(e){e.success&&$.each(e.data.slots,(function(t,a){$(".no-time-slot").addClass("d-none"),null==e.data.bookedSlot?$("#slotData").append('<span class="time-slot col-2" data-id="'+a+'">'+a+"</span>"):-1!==$.inArray(a,e.data.bookedSlot)?$("#slotData").append('<span class="time-slot col-2 bookedSlot " data-id="'+a+'">'+a+"</span>"):$("#slotData").append('<span class="time-slot col-2" data-id="'+a+'">'+a+"</span>")}))},error:function(e){$(".book-appointment-message").css("display","block");var t='<div class="gen alert alert-danger">'+e.responseJSON.message+"</div>";$(".book-appointment-message").html(t).delay(5e3).hide("slow")}})})),$(document).on("click",".time-slot",(function(){$(".time-slot").hasClass("activeSlot")?($(".time-slot").removeClass("activeSlot"),$(this).addClass("activeSlot")):$(this).addClass("activeSlot");var e=$(this).attr("data-id").split("-"),t=e[0],a=e[1];$("#timeSlot").val(""),$("#toTime").val(""),$("#timeSlot").val(t),$("#toTime").val(a)}));parseInt($("#addFees").val());var s=$("#serviceId").val();$(document).on("change","#doctorId",(function(){$("#payableAmountText").addClass("d-none"),$("#chargeId").val(""),$("#payableAmount").val(""),$("#templateAppointmentDate").val(""),$("#addFees").val(""),$("#slotData").html(""),$(".no-time-slot").removeClass("d-none"),$(e).removeAttr("disabled"),$.ajax({url:route("get-service"),type:"GET",data:{doctorId:$(this).val()},success:function(t){t.success&&($(e).removeAttr("disabled"),$("#serviceId").empty(),$("#serviceId").append($('<option value=""></option>').text("Select Service")),$.each(t.data,(function(e,t){$("#serviceId").append($("<option></option>").attr("value",t.id).attr("selected",t.id==s).text(t.name))})),s&&$("#serviceId").val()&&$("#payableAmountText").removeClass("d-none"),$("#serviceId").selectpicker("refresh"))}})}));var n="";$(document).on("change","#serviceId",(function(){""!=$(this).val()?$.ajax({url:route("get-charge"),type:"GET",data:{chargeId:$(this).val()},success:function(e){e.success&&($("#payableAmountText").removeClass("d-none"),$("#payableAmount").text(currencyIcon+" "+getFormattedPrice(e.data.charges)),n=e.data.charges,e.data.charges)}}):$("#payableAmountText").addClass("d-none")})),$("#frontAppointmentBook").on("submit",(function(e){e.preventDefault();var a=$("#template-medical-first_name").val().trim(),o=$("#template-medical-last_name").val().trim(),s=$("#template-medical-email").val().trim(),i=$("#doctorId").val().trim(),r=$("#serviceId").val().trim(),d=$("#templateAppointmentDate").val().trim(),l=$("#paymentMethod").val().trim();if($(".book-appointment-message").css("display","block"),!$("#isPatientAccount").is(":checked")){if(""==a)return m='<div class="gen alert alert-danger">First name field is required. </div>',$(window).scrollTop($(".appointment-form").offset().top),$(".book-appointment-message").html(m).delay(5e3).hide("slow"),!1;if(""==o)return m='<div class="gen alert alert-danger">Last name field is required. </div>',$(window).scrollTop($(".appointment-form").offset().top),$(".book-appointment-message").html(m).delay(5e3).hide("slow"),!1}if(""==s)return m='<div class="gen alert alert-danger">Email field is required. </div>',$(".book-appointment-message").html(m).delay(5e3).hide("slow"),$(window).scrollTop($(".appointment-form").offset().top),!1;if(""==i)return m='<div class="gen alert alert-danger">Doctor field is required. </div>',$(".book-appointment-message").html(m).delay(5e3).hide("slow"),$(window).scrollTop($(".appointment-form").offset().top),!1;if(""==r)return m='<div class="gen alert alert-danger">Services field is required. </div>',$(".book-appointment-message").html(m).delay(5e3).hide("slow"),$(window).scrollTop($(".appointment-form").offset().top),!1;if(""==d)return m='<div class="gen alert alert-danger">Appointment date field is required. </div>',$(".book-appointment-message").html(m).delay(5e3).hide("slow"),$(window).scrollTop($(".appointment-form").offset().top),!1;if(""==l)return m='<div class="gen alert alert-danger">Payment Method field is required. </div>',$(".book-appointment-message").html(m).delay(5e3).hide("slow"),$(window).scrollTop($(".appointment-form").offset().top),!1;var c=$(this).find("#saveBtn");setFrontBtnLoader(c);var p=new FormData($(this)[0]);p.append("payable_amount",n);var m='<div class="alert alert-warning alert-dismissable"> Processing.. </div>';jQuery(this).find(".book-appointment-message").html(m).show("slow"),$.ajax({url:$(this).attr("action"),type:"POST",data:p,processData:!1,contentType:!1,success:function(e){if(e.success){var a=e.data.appointmentId;if(m='<div class="gen alert alert-success">'+e.message+"</div>",$(".book-appointment-message").html(m).delay(5e3).hide("slow"),$(window).scrollTop($(".appointment-form").offset().top),$("#frontAppointmentBook")[0].reset(),e.data.payment_type==paystack)return location.href=e.data.redirect_url;if(e.data.payment_type==authorizeMethod&&window.location.replace(route("authorize.init",{appointmentId:a})),e.data.payment_type==paytmMethod&&window.location.replace(route("paytm.init",{appointmentId:a})),e.data.payment_type==paypal&&$.ajax({type:"GET",url:route("paypal.init"),data:{appointmentId:a},success:function(e){if(201==e.statusCode){var t="";$.each(e.result.links,(function(e,a){"approve"==a.rel&&(t=a.href)})),location.href=t}},error:function(e){},complete:function(){}}),e.data.payment_type==razorpayMethod&&$.ajax({type:"POST",url:route("razorpay.init"),data:{_token:csrfToken,appointmentId:a},success:function(e){if(e.success){var o=e.data,s=o.id,n=o.amount,i=o.name,r=o.email,d=o.contact;options.amount=n,options.order_id=s,options.prefill.name=i,options.prefill.email=r,options.prefill.contact=d,options.prefill.appointmentID=a;var l=new Razorpay(options);l.open(),l.on("payment.failed",t)}},error:function(e){},complete:function(){}}),e.data.payment_type==stripeMethod){var o=e.data[0].sessionId;stripe.redirectToCheckout({sessionId:o}).then((function(e){manageAjaxErrors(e)}))}e.data===manually&&setTimeout((function(){location.reload()}),1200)}},error:function(e){$(".book-appointment-message").css("display","block"),m='<div class="gen alert alert-danger">'+e.responseJSON.message+"</div>",$(window).scrollTop($(".appointment-form").offset().top),$(".book-appointment-message").html(m).delay(5e3).hide("slow")},complete:function(){setFrontBtnLoader(c)}})}))})),$(document).on("click",".show-more-btn",(function(){$(".question").hasClass("d-none")?($(".question").removeClass("d-none"),$(".show-more-btn").html("show less")):($(".show-content").addClass("d-none"),$(".show-more-btn").html("show more"))})),$(document).ready((function(){var t=(new Date).getTimezoneOffset();t=0===t?0:-t;var a=$("#templateAppointmentDate").val();""!=$("#doctorId").val()&&($(e).removeAttr("disabled"),$.ajax({url:route("get-service"),type:"GET",data:{doctorId:$("#doctorId").val()},success:function(t){t.success&&($(e).removeAttr("disabled"),$("#serviceId").empty(),$("#serviceId").append($('<option value=""></option>').text("Select Service")),$.each(t.data,(function(e,t){$("#serviceId").append($("<option></option>").attr("value",t.id).text(t.name))})),$("#serviceId").selectpicker("refresh"))}}));if(""!=$("#serviceId").val()&&$.ajax({url:route("get-charge"),type:"GET",data:{chargeId:$("#serviceId").val()},success:function(e){e.success&&($("#payableAmountText").removeClass("d-none"),$("#payableAmount").text(currencyIcon+" "+getFormattedPrice(e.data.charges)),e.data.charges,e.data.charges)}}),!a)return!1;$("#slotData").html(""),$.ajax({url:route("doctor-session-time"),type:"GET",data:{doctorId:$("#doctorId").val(),date:a,timezone_offset_minutes:t},success:function(e){e.success&&$.each(e.data.slots,(function(t,a){$(".no-time-slot").addClass("d-none"),null==e.data.bookedSlot?$("#slotData").append('<span class="time-slot col-2" data-id="'+a+'">'+a+"</span>"):-1!==$.inArray(a,e.data.bookedSlot)?$("#slotData").append('<span class="time-slot col-2 bookedSlot " data-id="'+a+'">'+a+"</span>"):$("#slotData").append('<span class="time-slot col-2" data-id="'+a+'">'+a+"</span>")}))},error:function(e){$(".book-appointment-message").css("display","block");var t='<div class="gen alert alert-danger">'+e.responseJSON.message+"</div>";$(".book-appointment-message").html(t).delay(5e3).hide("slow")}})})),window.setFrontBtnLoader=function(e){if(e.attr("data-old-text"))return e.html(e.attr("data-old-text")).prop("disabled",!1),void e.removeAttr("data-old-text");e.attr("data-old-text",e.text()),e.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>').prop("disabled",!0)}})();